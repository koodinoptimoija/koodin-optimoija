<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Koodin Tarkistus</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }
        h1 {
            color: #2c3e50;
        }
        p {
            color: #34495e;
            line-height: 1.5;
        }
        select, textarea, button {
            padding: 10px;
            margin: 10px 0;
            font-size: 16px;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #2980b9;
        }
        #result {
            margin-top: 20px;
            font-weight: bold;
            font-size: 18px;
        }
        #charCount {
            font-size: 14px;
        }
        .warning-text {
            background-color: #f39c12;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin-top: 20px;
            font-size: 16px;
        }
        #errorNotification {
            color: red;
            display: none;
            font-weight: bold;
            margin-top: 20px;
        }
    </style>
</head>
<body>

    <h1>Koodin Tarkistus</h1>
    <p>Valitse koodin tyyppi ja sy√∂t√§ koodi alla olevaan kentt√§√§n. Kentt√§√§n voi sy√∂tt√§√§ maksimissaan 2000 merkki√§.</p>

    <!-- Ilmoitus, jos ES6 tai HTMLHint ei ole ladattu -->
    <div id="errorNotification">
        ‚ö†Ô∏è <strong>Varoitus:</strong> T√§m√§ sivusto ei tue ES6-koodin tarkistusta ja HTMLHint ei ole ladattu. K√§yt√§ vain ES5-syntaksia.
    </div>

    <!-- Valitse koodin tyyppi -->
    <label for="codeType">Valitse koodityyppi:</label>
    <select id="codeType">
        <option value="auto">Automaattinen tunnistus</option>
        <option value="javascript">JavaScript</option>
        <option value="html">HTML</option>
    </select>
    <br><br>

    <textarea id="codeInput" rows="10" cols="50" maxlength="2000"></textarea>
    
    <div id="charCount">Merkkim√§√§r√§: 0/2000</div>

    <p class="warning-text">‚ö†Ô∏è T√§m√§ tarkistus tukee vain ES5-koodia. ES6-syntaksia (esim. <code>let</code>, <code>const</code>, <code>class</code>) ei voi tarkistaa.</p>

    <button onclick="checkCode()">Tarkista Koodi</button>

    <div id="result"></div>

    <!-- Ladataan JSHint -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jshint/2.12.0/jshint.min.js"></script>

    <!-- Ladataan HTMLHint -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/htmlhint/0.13.1/htmlhint.min.js"></script>

    <script>
        // Funktio tarkistaa, onko koodissa ES6-ominaisuuksia
        function isES6(code) {
            var es6Patterns = [
                /\blet\b/,    // let-avainsana
                /\bconst\b/,  // const-avainsana
                /\([^\)]*\)\s*=>/, // arrow function
                /\bclass\b/,   // class-syntaksi
                /\bimport\b/,  // import
                /\bexport\b/   // export
            ];
            
            return es6Patterns.some(function(pattern) {
                return pattern.test(code);
            });
        }

        // Funktio p√§ivitt√§√§ merkkilaskurin ja tarkistaa, ylitt√§√§k√∂ merkkim√§√§r√§ sallitun rajan
        function updateCharCount() {
            var code = document.getElementById('codeInput').value;
            var charCount = code.length;
            var maxLength = 2000;
            var charCountDisplay = document.getElementById('charCount');
            
            charCountDisplay.textContent = 'Merkkim√§√§r√§: ' + charCount + '/' + maxLength;
            
            if (charCount > maxLength) {
                charCountDisplay.style.color = 'red';
            } else {
                charCountDisplay.style.color = 'black';
            }
        }

        // Funktio tarkistamiseen (HTML tai JavaScript)
        function checkCode() {
            var code = document.getElementById('codeInput').value;
            var resultDiv = document.getElementById('result');
            var codeType = document.getElementById('codeType').value;

            // Tarkistetaan, ett√§ koodikentt√§ ei ole tyhj√§
            if (code.trim() === "") {
                resultDiv.textContent = '‚ö†Ô∏è Sy√∂t√§ koodi ennen tarkistusta!';
                resultDiv.style.color = 'red';
                return;
            }

            // Jos koodin pituus on liian pitk√§, est√§mme sen tarkistamisen
            if (code.length > 2000) {
                resultDiv.textContent = '‚ö†Ô∏è Koodin pituus ylitt√§√§ sallitun rajan!';
                resultDiv.style.color = 'red';
                return;
            }

            // N√§ytet√§√§n virheilmoitus, jos HTMLHint ei ole ladattu tai ES6-koodia
            if (typeof HTMLHint === "undefined" || isES6(code)) {
                document.getElementById('errorNotification').style.display = 'block';
                return;
            } else {
                document.getElementById('errorNotification').style.display = 'none';
            }

            // Tunnistetaan koodin tyyppi automaattisesti
            if (codeType === 'javascript' || (codeType === 'auto' && isJSCode(code))) {
                checkJS(code);
            } else {
                checkHTML(code);
            }
        }

        // Funktio tarkistamaan, onko koodi JavaScripti√§
        function isJSCode(code) {
            return /function|var|let|const|return|if|else|for|while/.test(code);
        }

        // Funktio HTML-koodin tarkistamiseen
        function checkHTML(code) {
            var resultDiv = document.getElementById('result');

            if (typeof HTMLHint === "undefined") {
                resultDiv.textContent = "‚ö†Ô∏è Virhe: HTMLHint ei ole ladattu. HTML-tarkistus ei toimi.";
                resultDiv.style.color = "red";
                return;
            }

            var rules = { 
                "tag-pair": true, 
                "doctype-first": true, 
                "id-unique": true,
                "attr-lowercase": true,  // Attribuuttien pienet kirjaimet
                "alt-require": true      // Kuvien alt-tekstit
            };
            var errors = HTMLHint.verify(code, rules);

            if (errors.length === 0) {
                resultDiv.textContent = "‚úÖ HTML-koodi on validia!";
                resultDiv.style.color = "green";
            } else {
                resultDiv.innerHTML = "‚ùå Virheit√§ l√∂ytyi:<br>";
                errors.forEach(error => {
                    resultDiv.innerHTML += `üîπ Rivi ${error.line}: ${error.message}<br>`;
                });
                resultDiv.style.color = "red";
            }
        }

        // Funktio JavaScript-koodin tarkistamiseen
        function checkJS(code) {
            var resultDiv = document.getElementById('result');

            if (isES6(code)) {
                resultDiv.textContent = "‚ö†Ô∏è Et voi tarkistaa ES6-koodia. K√§yt√§ vain ES5-syntaksia!";
                resultDiv.style.color = "red";
                return;
            }

            var isValid = JSHINT(code, { esversion: 5 });

            if (isValid) {
                resultDiv.textContent = "‚úÖ JavaScript-koodi on virheet√∂nt√§!";
                resultDiv.style.color = "green";
            } else {
                resultDiv.innerHTML = "‚ùå Virheit√§ l√∂ytyi JavaScript-koodista:<br>";
                JSHINT.errors.forEach(error => {
                    resultDiv.innerHTML += `üîπ Rivi ${error.line}: ${error.reason}<br>`;
                });
                resultDiv.style.color = "red";
            }
        }

        // P√§ivitet√§√§n merkkim√§√§r√§
        document.getElementById('codeInput').addEventListener('input', updateCharCount);
    </script>

</body>
</html>

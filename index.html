<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Koodin Tarkistus</title>
  <style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
    }
    #result {
        margin-top: 20px;
        font-weight: bold;
    }
    #charCount {
        margin-top: 10px;
    }
    #result {
        margin-top: 20px;
    }
  </style>
</head>
<body>

  <h1>Koodin Tarkistus</h1>
  <p>Valitse, tarkistetaanko HTML vai JavaScript -koodi ja syötä koodi alla olevaan kenttään. Kenttään voi syöttää maksimissaan 2000 merkkiä.</p>

  <!-- Valitse koodin tyyppi -->
  <label for="codeType">Valitse koodityyppi:</label>
  <select id="codeType">
    <option value="html">HTML</option>
    <option value="javascript">JavaScript</option>
  </select>
  <br><br>

  <textarea id="codeInput" rows="10" cols="50" maxlength="2000" oninput="updateCharCount()"></textarea>

  <div id="charCount">Merkkimäärä: 0/2000</div>

  <button onclick="checkCode()">Tarkista Koodi</button>

  <div id="result"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jshint/2.12.0/jshint.min.js"></script> <!-- JSHint JavaScript tarkistukseen -->

  <script>
      // Funktio päivittää merkkilaskurin ja tarkistaa, ylittääkö merkkimäärä sallitun rajan
      function updateCharCount() {
          var code = document.getElementById('codeInput').value;
          var charCount = code.length;
          var maxLength = 2000;
          var charCountDisplay = document.getElementById('charCount');
          
          charCountDisplay.textContent = 'Merkkimäärä: ' + charCount + '/' + maxLength;
          
          // Tarkistetaan, ylittääkö merkkimäärä rajan
          if (charCount > maxLength) {
              charCountDisplay.style.color = 'red';
          } else {
              charCountDisplay.style.color = 'black';
          }
      }

      // Funktio koodin tarkistamiseen (HTML tai JavaScript)
      function checkCode() {
          var code = document.getElementById('codeInput').value;
          var resultDiv = document.getElementById('result');
          var codeType = document.getElementById('codeType').value;

          // Jos koodin pituus on liian pitkä, estämme sen tarkistamisen
          if (code.length > 2000) {
              resultDiv.textContent = 'Koodin pituus ylittää sallitun rajan!';
              resultDiv.style.color = 'red';
              return;
          }

          // HTML-tarkistus
          if (codeType === 'html') {
              // Käytetään DOMParseria HTML-tarkistukseen
              var parser = new DOMParser();
              var doc = parser.parseFromString(code, 'text/html');
              
              // Tarkistetaan, löytyykö virheellistä HTML:ää
              if (doc.documentElement.nodeName === 'html' && doc.body) {
                  // Jos virheitä ei ole, ilmoitetaan HTML:n olevan validia
                  resultDiv.textContent = 'HTML on validia!';
                  resultDiv.style.color = 'green';
              } else {
                  // Jos löytyy parservirheitä, näytetään ne
                  var error = doc.querySelector('parsererror');
                  if (error) {
                      resultDiv.textContent = 'Virheellinen HTML: ' + error.textContent;
                      resultDiv.style.color = 'red';
                  } else {
                      resultDiv.textContent = 'HTML ei ole validia, mutta virheilmoituksia ei löytynyt.';
                      resultDiv.style.color = 'orange';
                  }
              }
          }

          // JavaScript-tarkistus
          else if (codeType === 'javascript') {
              var isValid = JSHINT(code);
              if (isValid) {
                  resultDiv.textContent = 'JavaScript-koodi on virheetöntä!';
                  resultDiv.style.color = 'green';
              } else {
                  resultDiv.textContent = 'Virheitä löytyi:\n';
                  JSHINT.errors.forEach(function (error) {
                      resultDiv.textContent += `Rivi ${error.line}: ${error.reason}\n`;
                  });
                  resultDiv.style.color = 'red';
              }
          }
      }
  </script>

</body>
</html>
